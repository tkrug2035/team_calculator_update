<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Estimate Sheet - Pressure Washing Calculator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.js"></script>
    <style>
        @import url('https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css');
        .line-through { text-decoration: line-through; }
    </style>
</head>
<body class="bg-gray-100">
    <div id="app"></div>

    <script>
        // State management
        let state = {
            targetHourlyRate: 160,
            propertyType: 'residential',
            basicCleanDiscount: 0,
            services: [
                {
                    id: 1,
                    type: 'house',
                    name: 'House Washing',
                    size: '2k-3k',
                    complexity: 'standard',
                    serviceMultiplier: 1.0,
                    baseRates: {
                        '0-2k': { time: 2.481 },
                        '2k-3k': { time: 2.813 },
                        '3k-4k': { time: 3.750 },
                        '4k-5k': { time: 4.688 },
                        '5k-6k': { time: 5.625 }
                    },
                    packages: { A: false, B: false, C: false, D: false },
                    enabled: false
                },
                {
                    id: 2,
                    type: 'driveway',
                    name: 'Driveway Cleaning - Concrete',
                    size: '0-500',
                    serviceMultiplier: 1.0,
                    baseRates: {
                        '0-500': { time: 0.625 },
                        '500-1000': { time: 1.25 },
                        '1000-1500': { time: 1.875 },
                        '1500-2000': { time: 2.5 },
                        '2000-2500': { time: 3.0 },
                        '2500-3000': { time: 3.5 },
                        '3000-3500': { time: 4.0 },
                        '3500-4000': { time: 4.5 }
                    },
                    packages: { A: false, B: false, C: false, D: false },
                    enabled: false
                },
                {
                    id: 3,
                    type: 'pool_deck',
                    name: 'Pool Deck Cleaning',
                    size: '0-2000',
                    enclosureType: 'open',
                    serviceMultiplier: 1.0,
                    baseRates: {
                        '0-2000': { time: 1.406 },
                        '2000-4000': { time: 2.813 }
                    },
                    enclosureMultipliers: {
                        'open': 1.0,
                        'screened': 1.25
                    },
                    packages: { A: false, B: false, C: false, D: false },
                    enabled: false
                },
                {
                    id: 4,
                    type: 'pavers',
                    name: 'Paver Cleaning Patio/Driveway',
                    size: '0-500',
                    complexity: 'standard',
                    serviceMultiplier: 1.0,
                    baseRates: {
                        '0-500': { time: 1.856 },
                        '500-1000': { time: 1.856 },
                        '1000-1500': { time: 2.900 },
                        '1500-2000': { time: 3.625 },
                        '2000-2500': { time: 4.350 },
                        '2500-3000': { time: 5.075 },
                        '3000-3500': { time: 5.800 },
                        '3500-4000': { time: 6.525 }
                    },
                    packages: { A: false, B: false, C: false, D: false },
                    enabled: false
                },
                {
                    id: 5,
                    type: 'screen_enclosure',
                    name: 'Pool Screen Enclosure',
                    size: '0-2000',
                    complexity: 'standard',
                    serviceMultiplier: 1.0,
                    baseRates: {
                        '0-2000': { time: 2.813 },
                        '2000-4000': { time: 6.0 }
                    },
                    packages: { A: false, B: false, C: false, D: false },
                    enabled: false
                },
                {
                    id: 6,
                    type: 'gutter_interior',
                    name: 'Gutter Interior Cleaning',
                    size: { feet: 150, story: '1story' },
                    serviceMultiplier: 1.0,
                    baseRates: {
                        '1story': { timePerFt: 0.0125 },
                        '2story': { timePerFt: 0.025 }
                    },
                    packages: { A: false, B: false, C: false, D: false },
                    enabled: false
                },
                {
                    id: 7,
                    type: 'gutter_exterior',
                    name: 'Gutter Exterior Brightening',
                    size: { feet: 150, story: '1story' },
                    serviceMultiplier: 1.0,
                    baseRates: {
                        '1story': { timePerFt: 0.0125 },
                        '2story': { timePerFt: 0.025 }
                    },
                    packages: { A: false, B: false, C: false, D: false },
                    enabled: false
                },
                {
                    id: 8,
                    type: 'roof',
                    name: 'Roof Cleaning',
                    size: '0-1k',
                    roofType: 'asphalt',
                    gutterStatus: 'has_gutters',
                    storyLevel: '1story',
                    serviceMultiplier: 1.0,
                    baseRates: {
                        '0-1k': { time: 2.363 },
                        '1k-2k': { time: 4.725 },
                        '2k-3k': { time: 5.906 },
                        '3k-4k': { time: 8.269 },
                        '4k-5k': { time: 10.631 },
                        '5k-6k': { time: 13.000 },
                        '6k-7k': { time: 15.356 }
                    },
                    roofMultipliers: {
                        'asphalt': 1.0,
                        'metal': 1.25,
                        'metal_granular': 1.25,
                        'tpo': 1.25,
                        'other': 1.25
                    },
                    gutterMultipliers: {
                        'has_gutters': 1.0,
                        'no_gutters': 1.5
                    },
                    storyMultipliers: {
                        '1story': 1.0,
                        '2story': 1.55,
                        '3story': 2.25
                    },
                    packages: { A: false, B: false, C: false, D: false },
                    enabled: false
                },
                {
                    id: 13,
                    type: 'wooden_fence',
                    name: 'Wooden Fence Cleaning',
                    size: { feet: 100 },
                    serviceMultiplier: 1.0,
                    baseRates: {
                        'per_foot': { timePerFt: 0.0141 }
                    },
                    packages: { A: false, B: false, C: false, D: false },
                    enabled: false
                },
                {
                    id: 14,
                    type: 'deck',
                    name: 'Deck Cleaning',
                    size: '0-500',
                    deckType: 'wood',
                    serviceMultiplier: 1.0,
                    baseRates: {
                        '0-500': { time: 1.25 },
                        '500-1000': { time: 2.188 },
                        '1000-1500': { time: 3.125 },
                        '1500-2000': { time: 4.063 },
                        '2000-2500': { time: 5.0 },
                        '2500-3000': { time: 5.938 },
                        '3000-3500': { time: 6.875 },
                        '3500-4000': { time: 7.813 },
                        '4000-4500': { time: 8.75 },
                        '4500-5000': { time: 9.688 }
                    },
                    deckMultipliers: {
                        'wood': 1.0,
                        'trex': 0.85
                    },
                    packages: { A: false, B: false, C: false, D: false },
                    enabled: false
                },
                {
                    id: 9,
                    type: 'move_return',
                    name: 'Move & Return Items',
                    size: '0-25',
                    complexity: 'standard',
                    serviceMultiplier: 1.0,
                    baseRates: {
                        '0-25': { time: 0.469 },
                        '25-50': { time: 0.781 },
                        '50-75': { time: 1.094 },
                        '75-100': { time: 1.406 }
                    },
                    packages: { A: false, B: false, C: false, D: false },
                    enabled: false
                },
                {
                    id: 10,
                    type: 'outdoor_furniture',
                    name: 'Outdoor Furniture Cleaning',
                    size: 10,
                    serviceMultiplier: 1.0,
                    baseRate: { timePerPiece: 0.03125 },
                    packages: { A: false, B: false, C: false, D: false },
                    enabled: false
                },
                {
                    id: 11,
                    type: 'spot_free_windows',
                    name: 'Spot Free Window Cleaning',
                    size: 12,
                    serviceMultiplier: 1.0,
                    baseRate: { timePerWindow: 0.05 },
                    packages: { A: false, B: false, C: false, D: false },
                    enabled: false
                },
                {
                    id: 12,
                    type: 'protective_wax',
                    name: 'Protective Wax (Mildew Retardant)',
                    size: '0-2k',
                    serviceMultiplier: 1.0,
                    baseRates: {
                        '0-2k': { time: 1.0 },
                        '2k-3k': { time: 1.063 },
                        '3k-4k': { time: 1.125 },
                        '4k-5k': { time: 1.188 },
                        '5k-6k': { time: 1.25 }
                    },
                    packages: { A: false, B: false, C: false, D: false },
                    enabled: false
                }
            ]
        };

        const complexityMultipliers = {
            standard: 1.0,
            deep: 1.25
        };

        const propertyMultipliers = {
            residential: 1.0,
            commercial: 1.25,
            luxury: 1.4
        };

        // Utility functions
        const safeNumber = (value) => {
            const num = Number(value);
            return isNaN(num) ? 0 : num;
        };

        const safeToFixed = (value, decimals = 0) => {
            return safeNumber(value).toFixed(decimals);
        };

        // Calculation functions
        const calculateServicePrice = (service) => {
            if (!service) return { price: 0, time: 0, requiresEstimate: false };
            
            const complexityMult = safeNumber(complexityMultipliers[service.complexity] || 1.0);
            const propertyMult = safeNumber(propertyMultipliers[state.propertyType] || 1.0);
            const serviceMult = safeNumber(service.serviceMultiplier || 1.0);
            const hourlyRate = safeNumber(state.targetHourlyRate || 160);
            
            let baseTime = 0;

            try {
                if (service.type === 'house' || service.type === 'driveway' || service.type === 'screen_enclosure') {
                    const rate = service.baseRates?.[service.size];
                    baseTime = safeNumber(rate?.time);
                } else if (service.type === 'pool_deck') {
                    const rate = service.baseRates?.[service.size];
                    baseTime = safeNumber(rate?.time);
                    
                    if (service.enclosureMultipliers) {
                        const enclosureMult = safeNumber(service.enclosureMultipliers[service.enclosureType || 'open'] || 1.0);
                        baseTime *= enclosureMult;
                    }
                } else if (service.type === 'pavers' || service.type === 'deck') {
                    const rate = service.baseRates?.[service.size];
                    baseTime = safeNumber(rate?.time);
                    
                    if (service.type === 'deck' && service.deckMultipliers) {
                        const deckMult = safeNumber(service.deckMultipliers[service.deckType || 'wood'] || 1.0);
                        baseTime *= deckMult;
                    }
                } else if (service.type === 'roof') {
                    const rate = service.baseRates?.[service.size];
                    baseTime = safeNumber(rate?.time);
                    
                    if (service.roofMultipliers) {
                        const roofMult = safeNumber(service.roofMultipliers[service.roofType || 'asphalt'] || 1.0);
                        const gutterMult = safeNumber(service.gutterMultipliers?.[service.gutterStatus || 'has_gutters'] || 1.0);
                        const storyMult = safeNumber(service.storyMultipliers?.[service.storyLevel || '1story'] || 1.0);
                        baseTime *= roofMult * gutterMult * storyMult;
                    }
                } else if (service.type === 'gutter_interior' || service.type === 'gutter_exterior') {
                    const rate = service.baseRates?.[service.size?.story];
                    const timePerFt = safeNumber(rate?.timePerFt);
                    const feet = safeNumber(service.size?.feet);
                    baseTime = timePerFt * feet;
                } else if (service.type === 'wooden_fence') {
                    const rate = service.baseRates?.['per_foot'];
                    const timePerFt = safeNumber(rate?.timePerFt);
                    const feet = safeNumber(service.size?.feet);
                    baseTime = timePerFt * feet;
                } else if (service.baseRate) {
                    if (service.type === 'outdoor_furniture') {
                        const timePerPiece = safeNumber(service.baseRate.timePerPiece);
                        const size = safeNumber(service.size);
                        baseTime = timePerPiece * size;
                    } else if (service.type === 'spot_free_windows') {
                        const timePerWindow = safeNumber(service.baseRate.timePerWindow);
                        const size = safeNumber(service.size);
                        baseTime = timePerWindow * size;
                    }
                } else if (service.type === 'protective_wax' || service.type === 'move_return') {
                    const rate = service.baseRates?.[service.size];
                    baseTime = safeNumber(rate?.time);
                }
            } catch (error) {
                baseTime = 0;
            }

            const adjustedTime = baseTime * complexityMult * serviceMult;
            const finalPrice = adjustedTime * hourlyRate * propertyMult;
            
            return {
                price: safeNumber(finalPrice),
                time: safeNumber(adjustedTime),
                requiresEstimate: false
            };
        };

        const getPackageServices = (packageLetter) => {
            return state.services.filter(service => service.enabled && service.packages?.[packageLetter]);
        };

        const calculatePackageTotals = (packageLetter) => {
            const packageServices = getPackageServices(packageLetter);
            
            let totalPrice = 0;
            let totalTime = 0;
            
            packageServices.forEach(service => {
                const calc = calculateServicePrice(service);
                totalPrice += safeNumber(calc.price);
                totalTime += safeNumber(calc.time);
            });

            let finalTotal = totalPrice;
            let discountAmount = 0;
            if (packageLetter === 'A' && safeNumber(state.basicCleanDiscount) > 0) {
                discountAmount = safeNumber(state.basicCleanDiscount);
                finalTotal = Math.max(0, totalPrice - discountAmount);
            }

            const hourlyRate = totalTime > 0 ? finalTotal / totalTime : 0;

            return {
                subtotal: safeNumber(totalPrice),
                finalTotal: safeNumber(finalTotal),
                discount: discountAmount,
                time: safeNumber(totalTime),
                hourlyRate: safeNumber(hourlyRate),
                serviceCount: packageServices.length,
                allServices: packageServices
            };
        };

        // Event handlers
        const toggleService = (serviceId) => {
            const service = state.services.find(s => s.id === serviceId);
            if (service) {
                service.enabled = !service.enabled;
                render();
            }
        };

        const updateService = (serviceId, field, value) => {
            const service = state.services.find(s => s.id === serviceId);
            if (service) {
                if (field === 'size' && typeof service.size === 'object') {
                    service.size = { ...service.size, ...value };
                } else {
                    service[field] = value;
                }
                render();
            }
        };

        const togglePackage = (serviceId, packageLetter) => {
            const service = state.services.find(s => s.id === serviceId);
            if (service) {
                const currentlyChecked = service.packages[packageLetter];
                
                if (!currentlyChecked) {
                    service.packages[packageLetter] = true;
                    
                    if (packageLetter === 'A') {
                        service.packages['B'] = true;
                        service.packages['C'] = true;
                        service.packages['D'] = true;
                    } else if (packageLetter === 'B') {
                        service.packages['C'] = true;
                        service.packages['D'] = true;
                    } else if (packageLetter === 'C') {
                        service.packages['D'] = true;
                    }
                } else {
                    service.packages[packageLetter] = false;
                }
                
                render();
            }
        };

        // Render function
        const render = () => {
            const app = document.getElementById('app');
            app.innerHTML = `
                <div class="max-w-7xl mx-auto p-6 bg-white">
                    <div class="mb-8 text-center">
                        <h1 class="text-3xl font-bold text-gray-900 mb-2 flex items-center justify-center gap-2">
                            üìä Digital Estimate Sheet
                        </h1>
                        <p class="text-gray-600">Team calculator with package options</p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6 p-4 bg-gray-50 rounded-lg">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Property Type</label>
                            <select id="propertyType" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                                <option value="residential" ${state.propertyType === 'residential' ? 'selected' : ''}>Residential</option>
                                <option value="commercial" ${state.propertyType === 'commercial' ? 'selected' : ''}>Commercial (+25%)</option>
                                <option value="luxury" ${state.propertyType === 'luxury' ? 'selected' : ''}>Luxury (+40%)</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Target $/Hour</label>
                            <input type="number" id="targetHourlyRate" value="${state.targetHourlyRate}" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-2">
                            <div class="bg-white border border-gray-200 rounded-lg overflow-hidden">
                                <div class="bg-gray-50 border-b border-gray-200">
                                    <div class="grid grid-cols-12 gap-1 p-3 font-semibold text-xs">
                                        <div class="col-span-1">‚úì</div>
                                        <div class="col-span-2">Service</div>
                                        <div class="col-span-2">Config</div>
                                        <div class="col-span-1">Soil Level</div>
                                        <div class="col-span-1">$</div>
                                        <div class="col-span-1 text-center">A</div>
                                        <div class="col-span-1 text-center">B</div>
                                        <div class="col-span-1 text-center">C</div>
                                        <div class="col-span-1 text-center">D</div>
                                        <div class="col-span-1 text-center">Hr</div>
                                    </div>
                                </div>

                                <div class="divide-y divide-gray-200">
                                    <div class="bg-blue-50 border-b border-blue-200">
                                        <div class="p-3 text-center">
                                            <div class="text-sm font-bold text-blue-800">üè† CORE SERVICES</div>
                                        </div>
                                    </div>

                                    ${state.services.slice(0, 10).map(service => {
                                        const calculation = calculateServicePrice(service);
                                        const price = safeNumber(calculation.price);
                                        const time = safeNumber(calculation.time);
                                        
                                        return `
                                            <div class="grid grid-cols-12 gap-1 p-3 text-xs ${service.enabled ? 'bg-white' : 'bg-gray-50'}">
                                                <div class="col-span-1 flex items-center">
                                                    <input type="checkbox" ${service.enabled ? 'checked' : ''} 
                                                           onchange="toggleService(${service.id})" class="w-4 h-4">
                                                </div>
                                                <div class="col-span-2 flex items-center">
                                                    <span class="font-medium ${service.enabled ? 'text-gray-900' : 'text-gray-500'}">${service.name}</span>
                                                </div>
                                                <div class="col-span-2 flex items-center">
                                                    ${service.enabled ? getServiceConfig(service) : ''}
                                                </div>
                                                <div class="col-span-1 flex items-center">
                                                    ${service.enabled ? getComplexitySelector(service) : ''}
                                                </div>
                                                <div class="col-span-1 text-center flex items-center justify-center">
                                                    <span class="font-bold ${service.enabled ? 'text-green-600' : 'text-gray-400'}">
                                                        $${service.enabled ? safeToFixed(price, 0) : '0'}
                                                    </span>
                                                </div>
                                                ${['A', 'B', 'C', 'D'].map(pkg => `
                                                    <div class="col-span-1 text-center flex items-center justify-center">
                                                        <input type="checkbox" ${service.enabled && service.packages[pkg] ? 'checked' : ''} 
                                                               ${!service.enabled ? 'disabled' : ''} 
                                                               onchange="togglePackage(${service.id}, '${pkg}')" class="w-3 h-3">
                                                    </div>
                                                `).join('')}
                                                <div class="col-span-1 text-center flex items-center justify-center">
                                                    <span class="${service.enabled ? 'text-gray-600' : 'text-gray-400'}">
                                                        ${service.enabled ? safeToFixed(time, 1) : '0'}
                                                    </span>
                                                </div>
                                            </div>
                                        `;
                                    }).join('')}

                                    <div class="bg-gradient-to-r from-yellow-50 to-orange-50 border-t-2 border-b-2 border-yellow-200">
                                        <div class="p-3 text-center">
                                            <div class="text-sm font-bold text-orange-800">‚ú® PREMIUM ADD-ON SERVICES ‚ú®</div>
                                        </div>
                                    </div>

                                    ${state.services.slice(10).map(service => {
                                        const calculation = calculateServicePrice(service);
                                        const price = safeNumber(calculation.price);
                                        const time = safeNumber(calculation.time);
                                        
                                        return `
                                            <div class="grid grid-cols-12 gap-1 p-3 text-xs ${service.enabled ? 'bg-yellow-50' : 'bg-gray-50'}">
                                                <div class="col-span-1 flex items-center">
                                                    <input type="checkbox" ${service.enabled ? 'checked' : ''} 
                                                           onchange="toggleService(${service.id})" class="w-4 h-4">
                                                </div>
                                                <div class="col-span-2 flex items-center">
                                                    <span class="font-medium ${service.enabled ? 'text-gray-900' : 'text-gray-500'}">‚ú® ${service.name}</span>
                                                </div>
                                                <div class="col-span-2 flex items-center">
                                                    ${service.enabled ? getServiceConfig(service) : ''}
                                                </div>
                                                <div class="col-span-1 flex items-center">
                                                    ${service.enabled ? getComplexitySelector(service) : ''}
                                                </div>
                                                <div class="col-span-1 text-center flex items-center justify-center">
                                                    <span class="font-bold ${service.enabled ? 'text-green-600' : 'text-gray-400'}">
                                                        $${service.enabled ? safeToFixed(price, 0) : '0'}
                                                    </span>
                                                </div>
                                                ${['A', 'B', 'C', 'D'].map(pkg => `
                                                    <div class="col-span-1 text-center flex items-center justify-center">
                                                        <input type="checkbox" ${service.enabled && service.packages[pkg] ? 'checked' : ''} 
                                                               ${!service.enabled ? 'disabled' : ''} 
                                                               onchange="togglePackage(${service.id}, '${pkg}')" class="w-3 h-3">
                                                    </div>
                                                `).join('')}
                                                <div class="col-span-1 text-center flex items-center justify-center">
                                                    <span class="${service.enabled ? 'text-gray-600' : 'text-gray-400'}">
                                                        ${service.enabled ? safeToFixed(time, 1) : '0'}
                                                    </span>
                                                </div>
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                            </div>
                        </div>

                        <div class="lg:col-span-1">
                            <div class="sticky top-6">
                                <h2 class="text-2xl font-bold text-center text-gray-900 mb-6">Package Options</h2>
                                <div class="space-y-4">
                                    ${['A', 'B', 'C', 'D'].map(packageLetter => {
                                        const totals = calculatePackageTotals(packageLetter);
                                        const packageNames = {
                                            A: 'üè† Basic Clean',
                                            B: '‚≠ê Essential Clean',
                                            C: 'üëë Premium Shine',
                                            D: '‚ö° Complete Care'
                                        };
                                        const colors = {
                                            A: 'bg-blue-50 border-blue-200 text-blue-800',
                                            B: 'bg-green-50 border-green-200 text-green-800',
                                            C: 'bg-purple-50 border-purple-200 text-purple-800',
                                            D: 'bg-yellow-50 border-yellow-200 text-yellow-800'
                                        };
                                        
                                        return `
                                            <div class="${colors[packageLetter]} border-2 rounded-lg p-4">
                                                <div class="text-center">
                                                    <h3 class="font-bold text-lg mb-3">${packageNames[packageLetter]}</h3>
                                                    
                                                    ${totals.allServices.length > 0 ? `
                                                        <div>
                                                            ${packageLetter === 'A' ? `
                                                                <div class="mb-4">
                                                                    <label class="block text-xs font-medium text-gray-700 mb-1">Discount Amount</label>
                                                                    <div class="flex items-center justify-center gap-1">
                                                                        <span class="text-xs">$</span>
                                                                        <input type="number" min="0" value="${state.basicCleanDiscount}" 
                                                                               onchange="state.basicCleanDiscount = Number(this.value) || 0; render();"
                                                                               class="w-20 text-xs px-2 py-1 border border-gray-300 rounded" placeholder="0">
                                                                    </div>
                                                                </div>
                                                            ` : ''}

                                                            ${packageLetter === 'A' && totals.discount > 0 ? `
                                                                <div class="mb-3">
                                                                    <div class="text-lg text-gray-500 line-through">$${safeToFixed(totals.subtotal, 0)}</div>
                                                                    <div class="text-2xl font-bold text-green-600">$${safeToFixed(totals.finalTotal, 0)}</div>
                                                                    <div class="text-xs text-green-600">Discount: -$${safeToFixed(totals.discount, 0)}</div>
                                                                </div>
                                                            ` : `
                                                                <div class="text-2xl font-bold text-gray-900 mb-3">$${safeToFixed(totals.finalTotal || totals.subtotal, 0)}</div>
                                                            `}

                                                            <div class="text-sm text-gray-600 mb-4">${totals.serviceCount} services ‚Ä¢ ${safeToFixed(totals.time, 1)} hours</div>
                                                            
                                                            <div class="space-y-1 text-left mb-4">
                                                                <div class="text-xs font-medium text-gray-700 mb-2">Package Services:</div>
                                                                <div class="max-h-32 overflow-y-auto space-y-1">
                                                                    ${totals.allServices.map(service => {
                                                                        const serviceCalc = calculateServicePrice(service);
                                                                        const servicePrice = safeNumber(serviceCalc.price);
                                                                        return `
                                                                            <div class="flex justify-between bg-white rounded px-2 py-1 text-xs">
                                                                                <span class="truncate">${service.name}</span>
                                                                                <span class="font-medium">$${safeToFixed(servicePrice, 0)}</span>
                                                                            </div>
                                                                        `;
                                                                    }).join('')}
                                                                </div>
                                                            </div>
                                                            
                                                            <div class="mt-3 pt-3 border-t">
                                                                <div class="text-xs text-gray-600">Effective Rate</div>
                                                                <div class="font-bold ${totals.hourlyRate >= 160 ? 'text-green-600' : 'text-red-500'}">
                                                                    $${safeToFixed(totals.hourlyRate, 0)}/hour
                                                                </div>
                                                            </div>
                                                        </div>
                                                    ` : `
                                                        <div class="text-gray-500 text-sm py-8">
                                                            ${packageLetter === 'D' ? 'Select 7+ core services' : 
                                                              packageLetter === 'C' ? 'Select 4+ core services' :
                                                              packageLetter === 'B' ? 'Select 2+ core services' : 
                                                              'Select 1+ core services'}
                                                        </div>
                                                    `}
                                                </div>
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // Add event listeners
            document.getElementById('propertyType').onchange = (e) => {
                state.propertyType = e.target.value;
                render();
            };

            document.getElementById('targetHourlyRate').onchange = (e) => {
                state.targetHourlyRate = Number(e.target.value);
                render();
            };
        };

        const getServiceConfig = (service) => {
            if (!service.enabled) return '';
            
            if (service.type === 'house') {
                return `
                    <select onchange="updateService(${service.id}, 'size', this.value)" class="text-xs px-1 py-1 border rounded w-full">
                        <option value="0-2k" ${service.size === '0-2k' ? 'selected' : ''}>0-2k ft¬≤</option>
                        <option value="2k-3k" ${service.size === '2k-3k' ? 'selected' : ''}>2-3k ft¬≤</option>
                        <option value="3k-4k" ${service.size === '3k-4k' ? 'selected' : ''}>3-4k ft¬≤</option>
                        <option value="4k-5k" ${service.size === '4k-5k' ? 'selected' : ''}>4-5k ft¬≤</option>
                        <option value="5k-6k" ${service.size === '5k-6k' ? 'selected' : ''}>5-6k ft¬≤</option>
                    </select>
                `;
            } else if (service.type === 'driveway') {
                return `
                    <select onchange="updateService(${service.id}, 'size', this.value)" class="text-xs px-1 py-1 border rounded w-full">
                        <option value="0-500" ${service.size === '0-500' ? 'selected' : ''}>0-500 ft¬≤</option>
                        <option value="500-1000" ${service.size === '500-1000' ? 'selected' : ''}>500-1,000 ft¬≤</option>
                        <option value="1000-1500" ${service.size === '1000-1500' ? 'selected' : ''}>1,000-1,500 ft¬≤</option>
                        <option value="1500-2000" ${service.size === '1500-2000' ? 'selected' : ''}>1,500-2,000 ft¬≤</option>
                        <option value="2000-2500" ${service.size === '2000-2500' ? 'selected' : ''}>2,000-2,500 ft¬≤</option>
                        <option value="2500-3000" ${service.size === '2500-3000' ? 'selected' : ''}>2,500-3,000 ft¬≤</option>
                        <option value="3000-3500" ${service.size === '3000-3500' ? 'selected' : ''}>3,000-3,500 ft¬≤</option>
                        <option value="3500-4000" ${service.size === '3500-4000' ? 'selected' : ''}>3,500-4,000 ft¬≤</option>
                    </select>
                `;
            } else if (service.type === 'outdoor_furniture') {
                return `
                    <div class="flex items-center gap-1">
                        <input type="number" min="1" value="${service.size}" 
                               onchange="updateService(${service.id}, 'size', Number(this.value))"
                               class="w-12 text-xs px-1 py-1 border rounded">
                        <span>pcs</span>
                    </div>
                `;
            } else if (service.type === 'spot_free_windows') {
                return `
                    <div class="flex items-center gap-1">
                        <input type="number" min="1" value="${service.size}" 
                               onchange="updateService(${service.id}, 'size', Number(this.value))"
                               class="w-12 text-xs px-1 py-1 border rounded">
                        <span>windows</span>
                    </div>
                `;
            }
            return '';
        };

        const getComplexitySelector = (service) => {
            if (!service.enabled) return '';
            
            if (service.type === 'house' || service.type === 'pavers' || service.type === 'screen_enclosure' || service.type === 'move_return') {
                return `
                    <select onchange="updateService(${service.id}, 'complexity', this.value)" class="text-xs px-1 py-1 border rounded w-full">
                        <option value="standard" ${service.complexity === 'standard' ? 'selected' : ''}>Moderately soiled</option>
                        <option value="deep" ${service.complexity === 'deep' ? 'selected' : ''}>Heavily soiled</option>
                    </select>
                `;
            }
            return '';
        };

        // Initialize the app
        render();
    </script>
</body>
</html>
